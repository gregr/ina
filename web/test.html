<!DOCTYPE html>
<style>
.hframe {
  display: table-cell;
  border: 1px solid;
}
.vframe {
  display: table-row;
  border: 1px solid #000000;
}
.chassis {
  display: inline-block;
  vertical-align: top;
  border-collapse: collapse;
  margin: 1px;
  border: 2px solid #336666;
}
.atom {
  cursor: pointer;
  background-color: #cccccc;
  font-family: monospace;
  white-space: pre;
  min-width: 10px;
  min-height: 10px;
}
</style>
<div id="target"></div>
<button id="add">add</button>
<input id="key" type="number"></input>
<button id="remove">remove</button>
<script src="data.js"></script>
<script src="relation.js"></script>
<script>
'use strict';
// TODO: escape_html
function html_atom(atom) {
  return '<div class="atom hframe">' + atom.toString() + '</div>';
}
function html_array(xs) {
  var atoms = [];
  for (var i = 0, len = xs.length; i < len; ++i) {
    atoms.push(html_atom(xs[i]));
  }
  return '<div class="chassis">' + atoms.join('') + '</div>';
}
function html_btree(bt) {
  if (bt.children) {
    var subs = [];
    var keys = array_insert(bt.keys, 0, '_');
    for (var i = 0, len = bt.children.length; i < len; ++i) {
      subs.push('<div class="chassis hframe"><div class="vframe>"><div class="chassis">'+html_atom(keys[i])+'</div></div>'+html_btree(bt.children[i])+'</div>');
    }
    return '<div class="chassis">' + subs.join('') + '</div>'
  } else { return html_array(bt.keys); }
}
var log = [];
var current_btree = btree_from_list(range(0, 49));
var input_key = document.getElementById('key');
var button_add = document.getElementById('add');
var button_remove = document.getElementById('remove');

function update() { target.innerHTML = html_btree(current_btree); }
function add_key() {
  current_btree = btree_put(current_btree, +input_key.value, +input_key.value);
  log.push(['add', +input_key.value]);
  update();
}
function remove_key() {
  current_btree = btree_remove(current_btree, +input_key.value);
  log.push(['remove', +input_key.value]);
  update();
}
function enter_key(e) {
  if (e.type === 'keypress' && e.key !== 'Enter') return;
  add_key();
  ++input_key.value;
}
function remove_selected(e) {
  if (e.target.classList.contains('atom')) {
    var value = e.target.innerHTML;
    if (value === '_') return;
    input_key.value = value;
    remove_key();
  }
}

input_key.addEventListener('keypress', enter_key, true);
button_add.addEventListener('click', add_key, true);
button_remove.addEventListener('click', remove_key, true);

var target = document.getElementById('target');
target.addEventListener('click', remove_selected, false);
update();
</script>
